<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v0.3 plugin-docs plugin-id-default docs-doc-id-rancher/cloud-provider">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Harvester Cloud Provider | Harvester</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.harvesterhci.io/zh/v0.3/rancher/cloud-provider"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="v0.3"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v0.3"><meta data-rh="true" name="docsearch:version" content="v0.3"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v0.3"><meta data-rh="true" property="og:title" content="Harvester Cloud Provider | Harvester"><meta data-rh="true" name="description" content="Available as of v0.3.0"><meta data-rh="true" property="og:description" content="Available as of v0.3.0"><meta data-rh="true" name="keywords" content="Harvester,harvester,RKE,rke,RKE2,rke2,Harvester Cloud Provider"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.harvesterhci.io/zh/v0.3/rancher/cloud-provider"><link data-rh="true" rel="alternate" href="https://docs.harvesterhci.io/v0.3/rancher/cloud-provider" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.harvesterhci.io/zh/v0.3/rancher/cloud-provider" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.harvesterhci.io/v0.3/rancher/cloud-provider" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://U7QCSJFCWR-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>


<link rel="search" type="application/opensearchdescription+xml" title="Harvester" href="/zh/opensearch.xml"><link rel="stylesheet" href="/zh/assets/css/styles.9db99928.css">
<link rel="preload" href="/zh/assets/js/runtime~main.2eb6797d.js" as="script">
<link rel="preload" href="/zh/assets/js/main.901cadfa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logo_horizontal.svg" alt="Harvester Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/logo_horizontal.svg" alt="Harvester Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/v0.3/">v0.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/dev/rancher/cloud-provider">v1.2-dev</a></li><li><a class="dropdown__link" href="/zh/v1.1/rancher/cloud-provider">v1.1</a></li><li><a class="dropdown__link" href="/zh/v1.0/rancher/cloud-provider">v1.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/v0.3/rancher/cloud-provider">v0.3</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/v0.3/rancher/cloud-provider" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/v0.3/rancher/cloud-provider" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__docs navbar__link--active" href="/zh/v0.3/">文档</a><a href="https://www.suse.com/c/?s=harvester" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__blog">博文<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://harvesterhci.io/kb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__kb">知识库<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/harvester/harvester" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v0.3/">Harvester Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v0.3/install/iso-install">Installation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v0.3/authentication">Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v0.3/upgrade">Upgrading Harvester</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v0.3/upload-image">Upload Images</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v0.3/host/">Host Management</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v0.3/vm/create-vm">VM Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v0.3/networking/harvester-network">Networking</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v0.3/monitoring/">Monitoring</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/v0.3/rancher/rancher-integration">Rancher Integration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v0.3/rancher/rancher-integration">Rancher Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v0.3/rancher/virtualization-management">Virtualization Management</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh/v0.3/rancher/node/node-driver">Harvester Node Driver</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/v0.3/rancher/cloud-provider">Harvester Cloud Provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/v0.3/rancher/csi-driver">Harvester CSI Driver</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v0.3/terraform/">Harvester Terraform Provider</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/v0.3/troubleshooting/installation">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/v0.3/faq">FAQ</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div><div><b>Harvester</b> <b>v0.3</b> 已 EOL，此文档已不再积极维护。有关更多信息，请前往 <a href="https://www.suse.com/suse-harvester/support-matrix/all-supported-versions/"><b>SUSE support matrix</b></a>。</div></div><div class="margin-top--md">最新的文档请参阅<b><a href="/zh/v1.1/rancher/cloud-provider">最新版本</a></b> (<!-- -->v1.1<!-- -->)。</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Rancher Integration</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Harvester Cloud Provider</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：v0.3</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Harvester Cloud Provider</h1></header><p><em>Available as of v0.3.0</em></p><p>Users can now provision both <a href="/zh/v0.3/rancher/node/rke1-cluster">RKE1</a> and <a href="/zh/v0.3/rancher/node/rke2-cluster">RKE2</a> clusters in Rancher 2.6.1, using the built-in Harvester Node Driver. Harvester can now provide <a href="#load-balancer-support">load balancer</a> support as well as <a href="/zh/v0.3/rancher/csi-driver">cluster Persistent Storage</a> support to the guest Kubernetes cluster.</p><p>In this page we will learn:</p><ul><li>How to deploy the Harvester cloud provider in both RKE1 and RKE2.</li><li>How to configure a <a href="#load-balancer-support">LoadBalancer service</a>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploying">Deploying<a href="#deploying" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><ul><li>The Kubernetes cluster is built on top of Harvester virtual machines.</li><li>The Harvester virtual machines run as guest Kubernetes nodes are in the same namespace.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-to-the-rke1-cluster-with-harvester-node-driver">Deploying to the RKE1 Cluster with Harvester Node Driver<a href="#deploying-to-the-rke1-cluster-with-harvester-node-driver" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>When spinning up an RKE cluster using the Harvester node driver, you can perform two steps to deploy the <code>Harvester</code> cloud provider:</p><ul><li><p>Select the <code>External</code> cloud provider.</p><p><img loading="lazy" src="/zh/assets/images/rke-cloud-provider-7e3efc40ff6c4c3cfcd76d41ce61341e.png" width="2628" height="1302" class="img_ev3q"></p></li><li><p>Generate add-on configuration and add it to the RKE YAML file.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># depend on kubectl to operate the Harvester cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sfL https://raw.githubusercontent.com/harvester/cloud-provider-harvester/master/deploy/generate_addon.sh | sh -s &lt;serviceAccount name&gt; &lt;namespace&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-to-the-rke2-cluster-with-harvester-node-driver">Deploying to the RKE2 Cluster with Harvester Node Driver<a href="#deploying-to-the-rke2-cluster-with-harvester-node-driver" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>When spinning up an RKE2 cluster using the Harvester node driver, select the <code>Harvester</code> cloud provider. The node driver will then help deploy both the CSI driver and CCM automatically.</p><p>  <img loading="lazy" src="/zh/assets/images/rke2-cloud-provider-2d541c4c966ae1adf2f7c375ea1743ac.png" width="1669" height="315" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="load-balancer-support">Load Balancer Support<a href="#load-balancer-support" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>After deploying the Harvester cloud provider, users can now configure a Kubernetes service of the type <code>LoadBalancer</code>. Currently, users can only set the load balancer configuration using <code>service annotations</code>.</p><p>  <img loading="lazy" src="/zh/assets/images/lb-svc-9f1cd5af6a99342fb70b53ca82e52c10.png" width="3578" height="1958" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Example</div><div class="admonitionContent_S0QG"><p>You can specify the Harvester LoadBalancer service config through annotations. The <code>cloudprovider.harvesterhci.io/healthcheck-port</code> annotation is required. For example:</p><ul><li><code>cloudprovider.harvesterhci.io/ipam: dhcp</code> - if the network of your Kubernetes nodes supports DHCP.</li><li><code>cloudprovider.harvesterhci.io/healthcheck-port: 80</code> - specify the port of your service.</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ipam">IPAM<a href="#ipam" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Harvester&#x27;s built-in load balancer supports both <code>pool</code> and <code>dhcp</code> modes. Users can specify the IPAM mode using the annotation key <code>cloudprovider.harvesterhci.io/ipam</code>. This value defaults to <code>pool</code>.</p><ul><li><p>pool: You should configure an IP address pool in Harvester in advance. The Harvester LoadBalancer controller will allocate an IP address from the IP address pool for the load balancer.</p><ul><li><p>Refer to the <a href="https://github.com/kube-vip/kube-vip-cloud-provider#global-and-namespace-pools" target="_blank" rel="noopener noreferrer">guideline</a> to configure an IP address pool. E.g, for a <code>Namespace</code> pool,
a service will take an address based upon its namespace pool cidr/range-namespace. These would look like the following:</p><div class="language-YAML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-YAML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get configmap -n kube-system kubevip -o yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name: kubevip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cidr-default: 192.168.0.200/29</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cidr-development: 192.168.0.210/29</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cidr-finance: 192.168.0.220/29</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cidr-testing: 192.168.0.230/29</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>dhcp:  A DHCP server is required. The Harvester LoadBalancer controller will request an IP address from the DHCP server of the Kubernetes nodes.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="health-checks">Health Checks<a href="#health-checks" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>The Harvester load balancer supports TCP health checks. Supported annotations are shown below:</p><table><thead><tr><th align="left">Key</th><th align="left">Value</th><th align="left">Required</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>cloudprovider.harvesterhci.io/healthcheck-port</code></td><td align="left">string</td><td align="left">true</td><td align="left">Specifies the port. The prober will access the address composed of the backend server IP and the port.</td></tr><tr><td align="left"><code>cloudprovider.harvesterhci.io/healthcheck-success-threshold</code></td><td align="left">string</td><td align="left">false</td><td align="left">Specifies the health check success threshold. The default value is 1. If the number of times the prober continuously detects an address successfully reaches the success threshold, then the backend server can start to forward traffic.</td></tr><tr><td align="left"><code>cloudprovider.harvesterhci.io/healthcheck-failure-threshold</code></td><td align="left">string</td><td align="left">false</td><td align="left">Specifies the success and failure threshold. The default value is 3. The backend server will stop forwarding traffic if the number of health check failures reaches the failure threshold.</td></tr><tr><td align="left"><code>cloudprovider.harvesterhci.io/healthcheck-periodseconds</code></td><td align="left">string</td><td align="left">false</td><td align="left">Specifies the health check period. The default value is 5 seconds.</td></tr><tr><td align="left"><code>cloudprovider.harvesterhci.io/healthcheck-timeoutseconds</code></td><td align="left">string</td><td align="left">false</td><td align="left">Specifies the timeout of every health check. The default value is 3 seconds.</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/harvester/docs/edit/main/versioned_docs/version-v0.3/rancher/cloud-provider.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2022-11-25T02:18:22.000Z">2022年11月25日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/v0.3/rancher/node/rke2-cluster"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Creating an RKE2 Kubernetes Cluster</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/v0.3/rancher/csi-driver"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Harvester CSI Driver</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deploying" class="table-of-contents__link toc-highlight">Deploying</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#deploying-to-the-rke1-cluster-with-harvester-node-driver" class="table-of-contents__link toc-highlight">Deploying to the RKE1 Cluster with Harvester Node Driver</a></li><li><a href="#deploying-to-the-rke2-cluster-with-harvester-node-driver" class="table-of-contents__link toc-highlight">Deploying to the RKE2 Cluster with Harvester Node Driver</a></li></ul></li><li><a href="#load-balancer-support" class="table-of-contents__link toc-highlight">Load Balancer Support</a><ul><li><a href="#ipam" class="table-of-contents__link toc-highlight">IPAM</a></li><li><a href="#health-checks" class="table-of-contents__link toc-highlight">Health Checks</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 harvesterhci.io</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.2eb6797d.js"></script>
<script src="/zh/assets/js/main.901cadfa.js"></script>
</body>
</html>
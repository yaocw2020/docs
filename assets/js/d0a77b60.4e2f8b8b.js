"use strict";(self.webpackChunkharvester_docs=self.webpackChunkharvester_docs||[]).push([[7232],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),c=u(n),g=o,m=c["".concat(s,".").concat(g)]||c[g]||d[g]||i;return n?a.createElement(m,l(l({ref:t},p),{},{components:n})):a.createElement(m,l({ref:t},p))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,l=new Array(i);l[0]=c;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:o,l[1]=r;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},43514:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>u});var a=n(87462),o=(n(67294),n(3905));const i={sidebar_position:1,sidebar_label:"Logging Audit Event",title:"Logging Audit Event",keywords:["Harvester","Logging","Audit","Event"]},l=void 0,r={unversionedId:"logging/logging",id:"version-v1.1/logging/logging",title:"Logging Audit Event",description:"Available as of v1.1.0",source:"@site/versioned_docs/version-v1.1/logging/logging.md",sourceDirName:"logging",slug:"/logging/",permalink:"/v1.1/logging/",draft:!1,editUrl:"https://github.com/harvester/docs/edit/main/versioned_docs/version-v1.1/logging/logging.md",tags:[],version:"v1.1",lastUpdatedAt:1672296666,formattedLastUpdatedAt:"Dec 29, 2022",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"Logging Audit Event",title:"Logging Audit Event",keywords:["Harvester","Logging","Audit","Event"]},sidebar:"tutorialSidebar",previous:{title:"Harvester Network Deep Dive",permalink:"/v1.1/networking/deep-dive"},next:{title:"Monitoring",permalink:"/v1.1/monitoring/"}},s={},u=[{value:"High-level Architecture",id:"high-level-architecture",level:2},{value:"Logging",id:"logging",level:2},{value:"Collected Logs",id:"collected-logs",level:3},{value:"Configuring Log Resources",id:"configuring-log-resources",level:3},{value:"From UI",id:"from-ui",level:4},{value:"From CLI",id:"from-cli",level:4},{value:"Configuring Log Destinations",id:"configuring-log-destinations",level:3},{value:"Clustered vs Namespaced",id:"clustered-vs-namespaced",level:4},{value:"From UI",id:"from-ui-1",level:4},{value:"Creating Outputs",id:"creating-outputs",level:5},{value:"Output",id:"output",level:6},{value:"Output Buffer",id:"output-buffer",level:6},{value:"Labels &amp; Annotations",id:"labels--annotations",level:6},{value:"Creating Flows",id:"creating-flows",level:5},{value:"Matches",id:"matches",level:6},{value:"Outputs",id:"outputs",level:6},{value:"Filters",id:"filters",level:6},{value:"From CLI",id:"from-cli-1",level:4},{value:"Referencing Secrets",id:"referencing-secrets",level:5},{value:"Example <code>Outputs</code>",id:"example-outputs",level:3},{value:"Elasticsearch",id:"elasticsearch",level:4},{value:"Graylog",id:"graylog",level:4},{value:"Splunk",id:"splunk",level:4},{value:"Loki",id:"loki",level:4},{value:"Audit",id:"audit",level:2},{value:"Audit Definition",id:"audit-definition",level:3},{value:"Audit Log Format",id:"audit-log-format",level:3},{value:"Audit Log Format in Kubernetes",id:"audit-log-format-in-kubernetes",level:4},{value:"Audit Log Format before Being Sent to Log Servers",id:"audit-log-format-before-being-sent-to-log-servers",level:4},{value:"Audit Log Output/ClusterOutput",id:"audit-log-outputclusteroutput",level:3},{value:"Audit Log Flow/ClusterFlow",id:"audit-log-flowclusterflow",level:3},{value:"Harvester",id:"harvester",level:3},{value:"Event",id:"event",level:2},{value:"Event Definition",id:"event-definition",level:3},{value:"Event Log Format",id:"event-log-format",level:3},{value:"Event Log Format in Kubernetes",id:"event-log-format-in-kubernetes",level:4},{value:"Event Log Format before Being Sent to Log Servers",id:"event-log-format-before-being-sent-to-log-servers",level:4},{value:"Event Log Output/ClusterOutput",id:"event-log-outputclusteroutput",level:3},{value:"Event Log Flow/ClusterFlow",id:"event-log-flowclusterflow",level:3}],p={toc:u};function d(e){let{components:t,...i}=e;return(0,o.kt)("wrapper",(0,a.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Available as of v1.1.0")),(0,o.kt)("p",null,"It is important to know what is happening/has happened in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Harvester Cluster"),"."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Harvester")," collects the ",(0,o.kt)("inlineCode",{parentName:"p"},"cluster running log"),", kubernetes ",(0,o.kt)("inlineCode",{parentName:"p"},"audit")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"event")," log right after the cluster is powered on, which is helpful for monitoring, logging, auditing and troubleshooting."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Harvester")," supports sending those logs to various types of log servers."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The size of logging data is related to the cluster scale, workload and other factors. ",(0,o.kt)("inlineCode",{parentName:"p"},"Harvester")," does not use persistent storage to store log data inside the cluster. Users need to set up a log server to receive logs accordingly.")),(0,o.kt)("h2",{id:"high-level-architecture"},"High-level Architecture"),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://banzaicloud.com/docs/one-eye/logging-operator/"},"Banzai Cloud Logging operator")," now powers both ",(0,o.kt)("inlineCode",{parentName:"p"},"Harvester")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Rancher")," as an in-house logging solution."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(24257).Z,width:"2642",height:"1372"})),(0,o.kt)("p",null,"In Harvester's practice, the ",(0,o.kt)("inlineCode",{parentName:"p"},"Logging"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Audit")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Event")," shares one architecture, the ",(0,o.kt)("inlineCode",{parentName:"p"},"Logging")," is the infrastructure, while the ",(0,o.kt)("inlineCode",{parentName:"p"},"Audit")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Event")," are on top of it."),(0,o.kt)("h2",{id:"logging"},"Logging"),(0,o.kt)("p",null,"The Harvester logging infrastructure allows you to aggregate Harvester logs into an external service such as ",(0,o.kt)("a",{parentName:"p",href:"https://www.graylog.org"},"Graylog"),", ",(0,o.kt)("a",{parentName:"p",href:"https://www.elastic.co/elasticsearch/"},"Elasticsearch"),", ",(0,o.kt)("a",{parentName:"p",href:"https://www.splunk.com/"},"Splunk"),", ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/oss/loki/"},"Grafana Loki")," and others."),(0,o.kt)("h3",{id:"collected-logs"},"Collected Logs"),(0,o.kt)("p",null,"See below for a list logs that are collected:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Logs from all cluster ",(0,o.kt)("inlineCode",{parentName:"li"},"Pods")),(0,o.kt)("li",{parentName:"ul"},"Kernel logs from each ",(0,o.kt)("inlineCode",{parentName:"li"},"node")),(0,o.kt)("li",{parentName:"ul"},"Logs from select systemd services from each node",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"rke2-server")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"rke2-agent")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"rancherd")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"rancher-system-agent")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"wicked")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"iscsid"))))),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Users are able to configure and modify where the aggregated logs are sent, as well as some basic filtering. It is not supported to change which logs are collected.")),(0,o.kt)("h3",{id:"configuring-log-resources"},"Configuring Log Resources"),(0,o.kt)("p",null,"Underneath Banzai Cloud's logging operator are ",(0,o.kt)("a",{parentName:"p",href:"https://www.fluentd.org/"},(0,o.kt)("inlineCode",{parentName:"a"},"fluentd"))," and ",(0,o.kt)("a",{parentName:"p",href:"https://fluentbit.io/"},(0,o.kt)("inlineCode",{parentName:"a"},"fluent-bit")),", which handle the log routing and collecting respectively.\nIf desired, you can modify how many resources are dedicated to those components."),(0,o.kt)("h4",{id:"from-ui"},"From UI"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Navigate to the ",(0,o.kt)("inlineCode",{parentName:"li"},"Configuration")," page under ",(0,o.kt)("inlineCode",{parentName:"li"},"Monitoring & Logging > Logging"),"."),(0,o.kt)("li",{parentName:"ol"},"Under the ",(0,o.kt)("inlineCode",{parentName:"li"},"Fluentbit")," tab, change the resource requests and limits."),(0,o.kt)("li",{parentName:"ol"},"Under the ",(0,o.kt)("inlineCode",{parentName:"li"},"Fluentd")," tab, change the resource requests and limits."),(0,o.kt)("li",{parentName:"ol"},"Click ",(0,o.kt)("inlineCode",{parentName:"li"},"Save")," on the bottom right of the screen.")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(49929).Z,width:"1920",height:"936"})),(0,o.kt)("h4",{id:"from-cli"},"From CLI"),(0,o.kt)("p",null,"You can also change the resource configurations from the command line using ",(0,o.kt)("inlineCode",{parentName:"p"},"kubectl edit managedchart -n fleet-local rancher-logging")," and modifying the relevant files."),(0,o.kt)("p",null,"For harvester version ",(0,o.kt)("inlineCode",{parentName:"p"},">= v1.1.0"),", the related paths and default values are:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# fluentbit\nvalues.fluentbit.resources.limits.cpu: 200m\nvalues.fluentbit.resources.limits.memory: 200mi\nvalues.fluentbit.resources.requests.cpu: 50m\nvalues.fluentbit.resources.requests.memory: 50mi\n---\n#fluentd\nvalues.fluentbit.resources.limits.cpu: 200m\nvalues.fluentbit.resources.limits.memory: 200mi\nvalues.fluentbit.resources.requests.cpu: 50m\nvalues.fluentbit.resources.requests.memory: 50mi\n")),(0,o.kt)("h3",{id:"configuring-log-destinations"},"Configuring Log Destinations"),(0,o.kt)("p",null,"Logging is backed by the ",(0,o.kt)("a",{parentName:"p",href:"https://banzaicloud.com/docs/one-eye/logging-operator/"},"Banzai Cloud Logging Operator"),", and so is controlled by ",(0,o.kt)("a",{parentName:"p",href:"https://banzaicloud.com/docs/one-eye/logging-operator/configuration/flow/"},(0,o.kt)("inlineCode",{parentName:"a"},"Flows"),"/",(0,o.kt)("inlineCode",{parentName:"a"},"ClusterFlows"))," and ",(0,o.kt)("a",{parentName:"p",href:"https://banzaicloud.com/docs/one-eye/logging-operator/configuration/output/"},(0,o.kt)("inlineCode",{parentName:"a"},"Outputs"),"/",(0,o.kt)("inlineCode",{parentName:"a"},"ClusterOutputs")),". You can route and filter logs as you like by applying these ",(0,o.kt)("inlineCode",{parentName:"p"},"CRD"),"s to the Harvester cluster."),(0,o.kt)("p",null,"When applying new ",(0,o.kt)("inlineCode",{parentName:"p"},"Ouptuts")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Flows")," to the cluster, it can take some time for the logging operator to effectively apply them. So please allow a few minutes for the logs to start flowing."),(0,o.kt)("h4",{id:"clustered-vs-namespaced"},"Clustered vs Namespaced"),(0,o.kt)("p",null,"One important thing to understand when routing logs is the difference between ",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterFlow")," vs ",(0,o.kt)("inlineCode",{parentName:"p"},"Flow")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterOutput")," vs ",(0,o.kt)("inlineCode",{parentName:"p"},"Output"),". The main difference between the clustered and non-clustered version of each is that the non-clustered versions are namespaced."),(0,o.kt)("p",null,"The biggest implication of this is that ",(0,o.kt)("inlineCode",{parentName:"p"},"Flows")," can only access ",(0,o.kt)("inlineCode",{parentName:"p"},"Outputs")," that are within the same namespace, but can still access any ",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterOutput"),"."),(0,o.kt)("p",null,"For more information, see the documentation:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://banzaicloud.com/docs/one-eye/logging-operator/configuration/flow/"},(0,o.kt)("inlineCode",{parentName:"a"},"Flows"),"/",(0,o.kt)("inlineCode",{parentName:"a"},"ClusterFlows"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://banzaicloud.com/docs/one-eye/logging-operator/configuration/output/"},(0,o.kt)("inlineCode",{parentName:"a"},"Outputs"),"/",(0,o.kt)("inlineCode",{parentName:"a"},"ClusterOutputs")))),(0,o.kt)("h4",{id:"from-ui-1"},"From UI"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"UI images are for ",(0,o.kt)("inlineCode",{parentName:"p"},"Output")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Flow")," whose configuration process is almost identical to their clustered counterparts. Any differences will be noted in the steps below.")),(0,o.kt)("h5",{id:"creating-outputs"},"Creating Outputs"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Choose the option to create a new ",(0,o.kt)("inlineCode",{parentName:"li"},"Output")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"ClusterOutput"),"."),(0,o.kt)("li",{parentName:"ol"},"If creating an ",(0,o.kt)("inlineCode",{parentName:"li"},"Output"),", select the desired namespace."),(0,o.kt)("li",{parentName:"ol"},"Add a name for the resources."),(0,o.kt)("li",{parentName:"ol"},"Select the logging type."),(0,o.kt)("li",{parentName:"ol"},"Select the logging output type.")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(39969).Z,width:"1894",height:"934"})),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"Configure the output buffer if necessary.")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(72855).Z,width:"1894",height:"934"})),(0,o.kt)("ol",{start:7},(0,o.kt)("li",{parentName:"ol"},"Add any labels or annotations.")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(613).Z,width:"1894",height:"934"})),(0,o.kt)("ol",{start:8},(0,o.kt)("li",{parentName:"ol"},"Once done, click ",(0,o.kt)("inlineCode",{parentName:"li"},"Create")," on the lower right.")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Depending on the output selected (Splunk, Elasticsearch, etc), there will be additional fields to specify in the form.")),(0,o.kt)("h6",{id:"output"},"Output"),(0,o.kt)("p",null,"The fields present in the ",(0,o.kt)("strong",{parentName:"p"},"Output")," form will change depending on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Output")," chosen, in order to expose the fields present for each ",(0,o.kt)("a",{parentName:"p",href:"https://banzaicloud.com/docs/one-eye/logging-operator/configuration/plugins/outputs/"},"output plugin"),"."),(0,o.kt)("h6",{id:"output-buffer"},"Output Buffer"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Output Buffer")," editor allows you to describe how you want the output buffer to behave. You can find the documentation for the buffer fields ",(0,o.kt)("a",{parentName:"p",href:"https://banzaicloud.com/docs/one-eye/logging-operator/configuration/plugins/outputs/buffer/"},"here"),"."),(0,o.kt)("h6",{id:"labels--annotations"},"Labels & Annotations"),(0,o.kt)("p",null,"You can append labels and annotations to the created resource."),(0,o.kt)("h5",{id:"creating-flows"},"Creating Flows"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Choose the option to create a new ",(0,o.kt)("inlineCode",{parentName:"li"},"Flow")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"ClusterFlow"),"."),(0,o.kt)("li",{parentName:"ol"},"If creating a ",(0,o.kt)("inlineCode",{parentName:"li"},"Flow"),", select the desired namespace."),(0,o.kt)("li",{parentName:"ol"},"Add a name for the resource."),(0,o.kt)("li",{parentName:"ol"},"Select any nodes whose logs to include or exclude.")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(35489).Z,width:"1894",height:"934"})),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"Select target ",(0,o.kt)("inlineCode",{parentName:"li"},"Outputs")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"ClusterOutputs"),".")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(30263).Z,width:"1894",height:"934"})),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"Add any filters if desired.")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(10270).Z,width:"1892",height:"935"})),(0,o.kt)("ol",{start:7},(0,o.kt)("li",{parentName:"ol"},"Once done, click ",(0,o.kt)("inlineCode",{parentName:"li"},"Create")," on the lower left.")),(0,o.kt)("h6",{id:"matches"},"Matches"),(0,o.kt)("p",null,"Matches allow you to filter which logs you want to include in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Flow"),". The form only allows you to include or exclude node logs, but if needed, you can add other match rules supported by the resource by selecting ",(0,o.kt)("inlineCode",{parentName:"p"},"Edit as YAML"),"."),(0,o.kt)("p",null,"For more information about the match directive, see ",(0,o.kt)("a",{parentName:"p",href:"https://banzaicloud.com/docs/one-eye/logging-operator/configuration/log-routing/"},"Routing your logs with match directive"),"."),(0,o.kt)("h6",{id:"outputs"},"Outputs"),(0,o.kt)("p",null,"Outputs allow you to select one or more ",(0,o.kt)("inlineCode",{parentName:"p"},"OutputRefs")," to send the aggregated logs to. When creating or editing a ",(0,o.kt)("inlineCode",{parentName:"p"},"Flow")," / ",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterFlow"),", it is required that the user selects at least one ",(0,o.kt)("inlineCode",{parentName:"p"},"Output"),"."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"There must be at least one existing ",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterOutput")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"Output")," that can be attached to the flow, or you will not be able to create / edit the flow.")),(0,o.kt)("h6",{id:"filters"},"Filters"),(0,o.kt)("p",null,"Filters allow you to transform, process, and mutate the logs. In the text edit, you will find descriptions of the supported filters, but for more information, you can visit the list of ",(0,o.kt)("a",{parentName:"p",href:"https://banzaicloud.com/docs/one-eye/logging-operator/configuration/plugins/filters/"},"supported filters"),"."),(0,o.kt)("h4",{id:"from-cli-1"},"From CLI"),(0,o.kt)("p",null,"To configure log routes via the command line, you only need to define the YAML files for the relevant resources:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# elasticsearch-logging.yaml\napiVersion: logging.banzaicloud.io/v1beta1\nkind: Output\nmetadata:\n   name: elasticsearch-example\n   namespace: fleet-local\n   labels:\n      example-label: elasticsearch-example\n   annotations:\n      example-annotation: elasticsearch-example\nspec:\n   elasticsearch:\n      host: <url-to-elasticsearch-server>\n      port: 9200\n---\napiVersion: logging.banzaicloud.io/v1beta1\nkind: Flow\nmetadata:\n   name: elasticsearch-example\n   namespace: fleet-local\nspec:\n   match:\n      - select: {}\n   globalOutputRefs:\n      - elasticsearch-example\n")),(0,o.kt)("p",null,"And then apply them:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f elasticsearch-logging.yaml\n")),(0,o.kt)("h5",{id:"referencing-secrets"},"Referencing Secrets"),(0,o.kt)("p",null,"There are 3 ways Banzai Cloud allows specifying secret values via yaml values."),(0,o.kt)("p",null,"The simplest is to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"value")," key, which is a simple string value for the desired secret. This method should only be used for testing and never in production:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'aws_key_id:\n  value: "secretvalue"\n')),(0,o.kt)("p",null,"The next is to use ",(0,o.kt)("inlineCode",{parentName:"p"},"valueFrom"),", which allows referencing a specific value from a secret by a name and key pair:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"aws_key_id:\n   valueFrom:\n      secretKeyRef:\n         name: <kubernetes-secret-name>\n         key: <kubernetes-secret-key>\n")),(0,o.kt)("p",null,"Some plugins require a file to read from rather than simply receiving a value from the secret (this is often the case for CA cert files). In these cases, you need to use ",(0,o.kt)("inlineCode",{parentName:"p"},"mountFrom"),", which will mount the secret as a file to the underlying ",(0,o.kt)("inlineCode",{parentName:"p"},"fluentd")," deployment and point the plugin to the file. The ",(0,o.kt)("inlineCode",{parentName:"p"},"valueFrom")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"mountFrom")," object look the same:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"tls_cert_path:\n   mountFrom:\n      secretKeyRef:\n         name: <kubernetes-secret-name>\n         key: <kubernetes-secret-key>\n")),(0,o.kt)("p",null,"For more information, you can find the related documentation ",(0,o.kt)("a",{parentName:"p",href:"https://banzaicloud.com/docs/one-eye/logging-operator/configuration/plugins/outputs/secret/"},"here"),"."),(0,o.kt)("h3",{id:"example-outputs"},"Example ",(0,o.kt)("inlineCode",{parentName:"h3"},"Outputs")),(0,o.kt)("h4",{id:"elasticsearch"},"Elasticsearch"),(0,o.kt)("p",null,"For the simplest deployment, you can deploy Elasticsearch on your local system using docker:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker run --name elasticsearch -p 9200:9200 -p 9300:9300 -e xpack.security.enabled=false -e node.name=es01 -it docker.elastic.co/elasticsearch/elasticsearch:6.8.23\n")),(0,o.kt)("p",null,"Make sure that you have set ",(0,o.kt)("inlineCode",{parentName:"p"},"vm.max_map_count")," to be >= 262144 or the docker command above will fail. Once the Elasticsearch server is up, you can create the yaml file for the ",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterOutput")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterFlow"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cat << EOF > elasticsearch-example.yaml\napiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterOutput\nmetadata:\n  name: elasticsearch-example\n  namespace: cattle-logging-system\nspec:\n  elasticsearch:\n    host: 192.168.0.119\n    port: 9200\n    buffer:\n      timekey: 1m\n      timekey_wait: 30s\n      timekey_use_utc: true\n---\napiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterFlow\nmetadata:\n  name: elasticsearch-example\n  namespace: cattle-logging-system\nspec:\n  match:\n    - select: {}\n  globalOutputRefs:\n    - elasticsearch-example\nEOF\n")),(0,o.kt)("p",null,"And apply the file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f elasticsearch-example.yaml\n")),(0,o.kt)("p",null,"After allowing some time for the logging operator to apply the resources, you can test that the logs are flowing:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'$ curl localhost:9200/fluentd/_search\n{\n  "took": 1,\n  "timed_out": false,\n  "_shards": {\n    "total": 5,\n    "successful": 5,\n    "skipped": 0,\n    "failed": 0\n  },\n  "hits": {\n    "total": 11603,\n    "max_score": 1,\n    "hits": [\n      {\n        "_index": "fluentd",\n        "_type": "fluentd",\n        "_id": "yWHr0oMBXcBggZRJgagY",\n        "_score": 1,\n        "_source": {\n          "stream": "stderr",\n          "logtag": "F",\n          "message": "I1013 02:29:43.020384       1 csi_handler.go:248] Attaching \\"csi-974b4a6d2598d8a7a37b06d06557c428628875e077dabf8f32a6f3aa2750961d\\"",\n          "kubernetes": {\n            "pod_name": "csi-attacher-5d4cc8cfc8-hd4nb",\n            "namespace_name": "longhorn-system",\n            "pod_id": "c63c2014-9556-40ce-a8e1-22c55de12e70",\n            "labels": {\n              "app": "csi-attacher",\n              "pod-template-hash": "5d4cc8cfc8"\n            },\n            "annotations": {\n              "cni.projectcalico.org/containerID": "857df09c8ede7b8dee786a8c8788e8465cca58f0b4d973c448ed25bef62660cf",\n              "cni.projectcalico.org/podIP": "10.52.0.15/32",\n              "cni.projectcalico.org/podIPs": "10.52.0.15/32",\n              "k8s.v1.cni.cncf.io/network-status": "[{\\n    \\"name\\": \\"k8s-pod-network\\",\\n    \\"ips\\": [\\n        \\"10.52.0.15\\"\\n    ],\\n    \\"default\\": true,\\n    \\"dns\\": {}\\n}]",\n              "k8s.v1.cni.cncf.io/networks-status": "[{\\n    \\"name\\": \\"k8s-pod-network\\",\\n    \\"ips\\": [\\n        \\"10.52.0.15\\"\\n    ],\\n    \\"default\\": true,\\n    \\"dns\\": {}\\n}]",\n              "kubernetes.io/psp": "global-unrestricted-psp"\n            },\n            "host": "harvester-node-0",\n            "container_name": "csi-attacher",\n            "docker_id": "f10e4449492d4191376d3e84e39742bf077ff696acbb1e5f87c9cfbab434edae",\n            "container_hash": "sha256:03e115718d258479ce19feeb9635215f98e5ad1475667b4395b79e68caf129a6",\n            "container_image": "docker.io/longhornio/csi-attacher:v3.4.0"\n          }\n        }\n      },\n       \n      ...\n       \n    ]\n  }\n}\n')),(0,o.kt)("h4",{id:"graylog"},"Graylog"),(0,o.kt)("p",null,"You can follow the instructions ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/w13915984028/harvester-develop-summary/blob/main/integrate-harvester-logging-with-log-servers.md#integrate-harvester-logging-with-graylog"},"here")," to deploy and view cluster logs via ",(0,o.kt)("a",{parentName:"p",href:"https://www.graylog.org/"},"Graylog"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterFlow\nmetadata:\n  name: "all-logs-gelf-hs"\n  namespace: "cattle-logging-system"\nspec:\n  globalOutputRefs:\n    - "example-gelf-hs"\n---\napiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterOutput\nmetadata:\n  name: "example-gelf-hs"\n  namespace: "cattle-logging-system"\nspec:\n  gelf:\n    host: "192.168.122.159"\n    port: 12202\n    protocol: "udp"\n')),(0,o.kt)("h4",{id:"splunk"},"Splunk"),(0,o.kt)("p",null,"You can follow the instructions ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/w13915984028/harvester-develop-summary/blob/main/test-log-event-audit-with-splunk.md"},"here")," to deploy and view cluster logs via ",(0,o.kt)("a",{parentName:"p",href:"https://www.splunk.com/"},"Splunk"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterOutput\nmetadata:\n  name: harvester-logging-splunk\n  namespace: cattle-logging-system \nspec:\n splunkHec:\n    hec_host: 192.168.122.101\n    hec_port: 8088\n    insecure_ssl: true\n    index: harvester-log-index\n    hec_token:\n      valueFrom:\n        secretKeyRef:\n          key: HECTOKEN\n          name: splunk-hec-token2\n    buffer:\n      chunk_limit_size: 3MB\n      timekey: 2m\n      timekey_wait: 1m\n---\napiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterFlow\nmetadata:\n   name: harvester-logging-splunk\n   namespace: cattle-logging-system\nspec:\n   filters:\n      - tag_normaliser: {}\n   match:\n   globalOutputRefs:\n      - harvester-logging-splunk\n")),(0,o.kt)("h4",{id:"loki"},"Loki"),(0,o.kt)("p",null,"You can follow the instructions in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/joshmeranda/harvester/blob/logging/enhancements/20220525-system-logging.md"},"logging HEP")," on deploying and viewing cluster logs via ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/oss/loki/"},"Grafana Loki"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterFlow\nmetadata:\n  name: harvester-loki\n  namespace: cattle-logging-system\nspec:\n  match:\n    - select: {}\n  globalOutputRefs:\n    - harvester-loki\n---\napiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterOutput\nmetadata:\n  name: harvester-loki\n  namespace: cattle-logging-system\nspec:\n  loki:\n    url: http://loki-stack.cattle-logging-system.svc:3100\n    extra_labels:\n      logOutput: harvester-loki\n")),(0,o.kt)("h2",{id:"audit"},"Audit"),(0,o.kt)("p",null,"Harvester collects Kubernetes ",(0,o.kt)("inlineCode",{parentName:"p"},"audit")," and is able to send the ",(0,o.kt)("inlineCode",{parentName:"p"},"audit")," to various types of log servers."),(0,o.kt)("p",null,"The policy file to guide ",(0,o.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," is ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/harvester/harvester-installer/blob/5991dcf6307aa5da79c5d6926566541f48105778/pkg/config/templates/rke2-92-harvester-kube-audit-policy.yaml"},"here"),"."),(0,o.kt)("h3",{id:"audit-definition"},"Audit Definition"),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"kubernetes"),", the ",(0,o.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/debug/debug-cluster/audit/"},"audit")," data is generated by ",(0,o.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," according to defined policy."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"...\nAudit policy\nAudit policy defines rules about what events should be recorded and what data they should include. The audit policy object structure is defined in the audit.k8s.io API group. When an event is processed, it's compared against the list of rules in order. The first matching rule sets the audit level of the event. The defined audit levels are:\n\nNone - don't log events that match this rule.\nMetadata - log request metadata (requesting user, timestamp, resource, verb, etc.) but not request or response body.\nRequest - log event metadata and request body but not response body. This does not apply for non-resource requests.\nRequestResponse - log event metadata, request and response bodies. This does not apply for non-resource requests.\n")),(0,o.kt)("h3",{id:"audit-log-format"},"Audit Log Format"),(0,o.kt)("h4",{id:"audit-log-format-in-kubernetes"},"Audit Log Format in Kubernetes"),(0,o.kt)("p",null,"Kubernetes apiserver logs audit with following JSON format into a local file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"kind":"Event",\n"apiVersion":"audit.k8s.io/v1",\n"level":"Metadata",\n"auditID":"13d0bf83-7249-417b-b386-d7fc7c024583",\n"stage":"RequestReceived",\n"requestURI":"/apis/flowcontrol.apiserver.k8s.io/v1beta2/prioritylevelconfigurations?fieldManager=api-priority-and-fairness-config-producer-v1",\n"verb":"create",\n"user":{"username":"system:apiserver","uid":"d311c1fe-2d96-4e54-a01b-5203936e1046","groups":["system:masters"]},\n"sourceIPs":["::1"],\n"userAgent":"kube-apiserver/v1.24.7+rke2r1 (linux/amd64) kubernetes/e6f3597",\n"objectRef":{"resource":"prioritylevelconfigurations",\n"apiGroup":"flowcontrol.apiserver.k8s.io",\n"apiVersion":"v1beta2"},\n"requestReceivedTimestamp":"2022-10-19T18:55:07.244781Z",\n"stageTimestamp":"2022-10-19T18:55:07.244781Z"\n}\n')),(0,o.kt)("h4",{id:"audit-log-format-before-being-sent-to-log-servers"},"Audit Log Format before Being Sent to Log Servers"),(0,o.kt)("p",null,"Harvester keeps the ",(0,o.kt)("inlineCode",{parentName:"p"},"audit")," log unchanged before sending it to the log server."),(0,o.kt)("h3",{id:"audit-log-outputclusteroutput"},"Audit Log Output/ClusterOutput"),(0,o.kt)("p",null,"To output audit related log, the ",(0,o.kt)("inlineCode",{parentName:"p"},"Output"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterOutput")," requires the value of ",(0,o.kt)("inlineCode",{parentName:"p"},"loggingRef")," to be ",(0,o.kt)("inlineCode",{parentName:"p"},"harvester-kube-audit-log-ref"),"."),(0,o.kt)("p",null,"When you configure from the Harvester dashboard, the field is added automatically."),(0,o.kt)("p",null,"Select type ",(0,o.kt)("inlineCode",{parentName:"p"},"Audit Only")," from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Type")," drpo-down list."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(68611).Z,width:"1466",height:"644"})),(0,o.kt)("p",null,"When you configure from the CLI, please add the field manually."),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'apiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterOutput\nmetadata:\n  name: "harvester-audit-webhook"\n  namespace: "cattle-logging-system"\nspec:\n  http:\n    endpoint: "http://192.168.122.159:8096/"\n    open_timeout: 3\n    format: \n      type: "json"\n    buffer:\n      chunk_limit_size: 3MB\n      timekey: 2m\n      timekey_wait: 1m\n  loggingRef: harvester-kube-audit-log-ref   # this reference is fixed and must be here\n')),(0,o.kt)("h3",{id:"audit-log-flowclusterflow"},"Audit Log Flow/ClusterFlow"),(0,o.kt)("p",null,"To route audit related logs, the ",(0,o.kt)("inlineCode",{parentName:"p"},"Flow"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterFlow")," requires the value of ",(0,o.kt)("inlineCode",{parentName:"p"},"loggingRef")," to be ",(0,o.kt)("inlineCode",{parentName:"p"},"harvester-kube-audit-log-ref"),"."),(0,o.kt)("p",null,"When you configure from the Harvester dashboard, the field is added automatically."),(0,o.kt)("p",null,"Select type ",(0,o.kt)("inlineCode",{parentName:"p"},"Audit"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(18724).Z,width:"1234",height:"558"})),(0,o.kt)("p",null,"When you config from the CLI, please add the field manually."),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'apiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterFlow\nmetadata:\n  name: "harvester-audit-webhook"\n  namespace: "cattle-logging-system"\nspec:\n  globalOutputRefs:\n    - "harvester-audit-webhook"\n  loggingRef: harvester-kube-audit-log-ref  # this reference is fixed and must be here\n')),(0,o.kt)("h3",{id:"harvester"},"Harvester"),(0,o.kt)("h2",{id:"event"},"Event"),(0,o.kt)("p",null,"Harvester collects Kubernetes ",(0,o.kt)("inlineCode",{parentName:"p"},"event")," and is able to send the ",(0,o.kt)("inlineCode",{parentName:"p"},"event")," to various types of log servers."),(0,o.kt)("h3",{id:"event-definition"},"Event Definition"),(0,o.kt)("p",null,"Kubernetes ",(0,o.kt)("inlineCode",{parentName:"p"},"events")," are objects that show you what is happening inside a cluster, such as what decisions were made by the scheduler or why some pods were evicted from the node. All core components and extensions (operators/controllers) may create events through the API Server."),(0,o.kt)("p",null,"Events have no direct relationship with log messages generated by the various components, and are not affected with the log verbosity level. When a component creates an event, it often emits a corresponding log message. Events are garbage collected by the API Server after a short time (typically after an hour), which means that they can be used to understand issues that are happening, but you have to collect them to investigate past events."),(0,o.kt)("p",null,"Events are the first thing to look at for application, as well as infrastructure operations when something is not working as expected. Keeping them for a longer period is essential if the failure is the result of earlier events, or when conducting post-mortem analysis."),(0,o.kt)("h3",{id:"event-log-format"},"Event Log Format"),(0,o.kt)("h4",{id:"event-log-format-in-kubernetes"},"Event Log Format in Kubernetes"),(0,o.kt)("p",null,"A ",(0,o.kt)("inlineCode",{parentName:"p"},"kubernetes event")," example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'        {\n            "apiVersion": "v1",\n            "count": 1,\n            "eventTime": null,\n            "firstTimestamp": "2022-08-24T11:17:35Z",\n            "involvedObject": {\n                "apiVersion": "kubevirt.io/v1",\n                "kind": "VirtualMachineInstance",\n                "name": "vm-ide-1",\n                "namespace": "default",\n                "resourceVersion": "604601",\n                "uid": "1bd4133f-5aa3-4eda-bd26-3193b255b480"\n            },\n            "kind": "Event",\n            "lastTimestamp": "2022-08-24T11:17:35Z",\n            "message": "VirtualMachineInstance defined.",\n            "metadata": {\n                "creationTimestamp": "2022-08-24T11:17:35Z",\n                "name": "vm-ide-1.170e43cbdd833b62",\n                "namespace": "default",\n                "resourceVersion": "604626",\n                "uid": "0114f4e7-1d4a-4201-b0e5-8cc8ede202f4"\n            },\n            "reason": "Created",\n            "reportingComponent": "",\n            "reportingInstance": "",\n            "source": {\n                "component": "virt-handler",\n                "host": "harv1"\n            },\n            "type": "Normal"\n        },\n')),(0,o.kt)("h4",{id:"event-log-format-before-being-sent-to-log-servers"},"Event Log Format before Being Sent to Log Servers"),(0,o.kt)("p",null,"Each ",(0,o.kt)("inlineCode",{parentName:"p"},"event log")," has the format of: ",(0,o.kt)("inlineCode",{parentName:"p"},'{"stream":"","logtag":"F","message":"","kubernetes":{""}}'),". The ",(0,o.kt)("inlineCode",{parentName:"p"},"kubernetes event")," is in the field ",(0,o.kt)("inlineCode",{parentName:"p"},"message"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n"stream":"stdout",\n\n"logtag":"F",\n\n"message":"{\n\\\\"verb\\\\":\\\\"ADDED\\\\",\n\n\\\\"event\\\\":{\\\\"metadata\\\\":{\\\\"name\\\\":\\\\"vm-ide-1.170e446c3f890433\\\\",\\\\"namespace\\\\":\\\\"default\\\\",\\\\"uid\\\\":\\\\"0b44b6c7-b415-4034-95e5-a476fcec547f\\\\",\\\\"resourceVersion\\\\":\\\\"612482\\\\",\\\\"creationTimestamp\\\\":\\\\"2022-08-24T11:29:04Z\\\\",\\\\"managedFields\\\\":[{\\\\"manager\\\\":\\\\"virt-controller\\\\",\\\\"operation\\\\":\\\\"Update\\\\",\\\\"apiVersion\\\\":\\\\"v1\\\\",\\\\"time\\\\":\\\\"2022-08-24T11:29:04Z\\\\"}]},\\\\"involvedObject\\\\":{\\\\"kind\\\\":\\\\"VirtualMachineInstance\\\\",\\\\"namespace\\\\":\\\\"default\\\\",\\\\"name\\\\":\\\\"vm-ide-1\\\\",\\\\"uid\\\\":\\\\"1bd4133f-5aa3-4eda-bd26-3193b255b480\\\\",\\\\"apiVersion\\\\":\\\\"kubevirt.io/v1\\\\",\\\\"resourceVersion\\\\":\\\\"612477\\\\"},\\\\"reason\\\\":\\\\"SuccessfulDelete\\\\",\\\\"message\\\\":\\\\"Deleted PodDisruptionBudget kubevirt-disruption-budget-hmmgd\\\\",\\\\"source\\\\":{\\\\"component\\\\":\\\\"disruptionbudget-controller\\\\"},\\\\"firstTimestamp\\\\":\\\\"2022-08-24T11:29:04Z\\\\",\\\\"lastTimestamp\\\\":\\\\"2022-08-24T11:29:04Z\\\\",\\\\"count\\\\":1,\\\\"type\\\\":\\\\"Normal\\\\",\\\\"eventTime\\\\":null,\\\\"reportingComponent\\\\":\\\\"\\\\",\\\\"reportingInstance\\\\":\\\\"\\\\"}\n}",\n\n"kubernetes":{"pod_name":"harvester-default-event-tailer-0","namespace_name":"cattle-logging-system","pod_id":"d3453153-58c9-456e-b3c3-d91242580df3","labels":{"app.kubernetes.io/instance":"harvester-default-event-tailer","app.kubernetes.io/name":"event-tailer","controller-revision-hash":"harvester-default-event-tailer-747b9d4489","statefulset.kubernetes.io/pod-name":"harvester-default-event-tailer-0"},"annotations":{"cni.projectcalico.org/containerID":"aa72487922ceb4420ebdefb14a81f0d53029b3aec46ed71a8875ef288cde4103","cni.projectcalico.org/podIP":"10.52.0.178/32","cni.projectcalico.org/podIPs":"10.52.0.178/32","k8s.v1.cni.cncf.io/network-status":"[{\\\\n    \\\\"name\\\\": \\\\"k8s-pod-network\\\\",\\\\n    \\\\"ips\\\\": [\\\\n        \\\\"10.52.0.178\\\\"\\\\n    ],\\\\n    \\\\"default\\\\": true,\\\\n    \\\\"dns\\\\": {}\\\\n}]","k8s.v1.cni.cncf.io/networks-status":"[{\\\\n    \\\\"name\\\\": \\\\"k8s-pod-network\\\\",\\\\n    \\\\"ips\\\\": [\\\\n        \\\\"10.52.0.178\\\\"\\\\n    ],\\\\n    \\\\"default\\\\": true,\\\\n    \\\\"dns\\\\": {}\\\\n}]","kubernetes.io/psp":"global-unrestricted-psp"},"host":"harv1","container_name":"harvester-default-event-tailer-0","docker_id":"455064de50cc4f66e3dd46c074a1e4e6cfd9139cb74d40f5ba00b4e3e2a7ab2d","container_hash":"docker.io/banzaicloud/eventrouter@sha256:6353d3f961a368d95583758fa05e8f4c0801881c39ed695bd4e8283d373a4262","container_image":"docker.io/banzaicloud/eventrouter:v0.1.0"}\n\n}\n\n')),(0,o.kt)("h3",{id:"event-log-outputclusteroutput"},"Event Log Output/ClusterOutput"),(0,o.kt)("p",null,"Events share the ",(0,o.kt)("inlineCode",{parentName:"p"},"Output"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterOutput")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"Logging"),"."),(0,o.kt)("p",null,"Select ",(0,o.kt)("inlineCode",{parentName:"p"},"Logging/Event")," from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Type")," drop-down list."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(68611).Z,width:"1466",height:"644"})),(0,o.kt)("h3",{id:"event-log-flowclusterflow"},"Event Log Flow/ClusterFlow"),(0,o.kt)("p",null,"Compared with the normal Logging ",(0,o.kt)("inlineCode",{parentName:"p"},"Flow"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterFlow"),", the ",(0,o.kt)("inlineCode",{parentName:"p"},"Event")," related ",(0,o.kt)("inlineCode",{parentName:"p"},"Flow"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterFlow"),", has one more match field with the value of ",(0,o.kt)("inlineCode",{parentName:"p"},"event-tailer"),"."),(0,o.kt)("p",null,"When you configure from the Harvester dashboard, the field is added automatically."),(0,o.kt)("p",null,"Select ",(0,o.kt)("inlineCode",{parentName:"p"},"Event")," from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Type")," drop-down list."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(18724).Z,width:"1234",height:"558"})),(0,o.kt)("p",null,"When you configure from the CLI, please add the field manually."),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"apiVersion: logging.banzaicloud.io/v1beta1\nkind: ClusterFlow\nmetadata:\n  name: harvester-event-webhook\n  namespace: cattle-logging-system\nspec:\n  filters:\n  - tag_normaliser: {}\n  match:\n  - select:\n      labels:\n        app.kubernetes.io/name: event-tailer\n  globalOutputRefs:\n    - harvester-event-webhook\n")))}d.isMDXComponent=!0},18724:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/cluster-flow-type-c14d56c2a81e14c1afefd30f61a9780b.png"},68611:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/cluster-output-type-9ebabd3cc3bb3b555bf620becd1b65da.png"},10270:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/create-flow-filters-e6b4e332e511c03cad22f4183ee403d3.png"},35489:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/create-flow-matches-e84e72fc6237b7c3e958ee431be10d67.png"},30263:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/create-flow-outputs-62d17c11b0d45b348d1aa8025d340d25.png"},72855:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/create-output-buffer-62c1b78c41a02d731c76f6cbc4126340.png"},613:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/create-output-labels-and-annotations-5a91c9c7380fea1f056de1dcfbd8d192.png"},39969:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/create-output-4780f942ae8568cb56cdca16e364b74e.png"},24257:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/fluent-operator-03f1565c626ff9df7a98035c4d9eca93.png"},49929:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/modify-logging-fluent-resources-5c54722eedbcc1c4018af4accd8b6348.png"}}]);
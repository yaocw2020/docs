<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-rancher/node/node-driver">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Harvester Node Driver | Harvester</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.harvesterhci.io/dev/rancher/node/node-driver"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Harvester Node Driver | Harvester"><meta data-rh="true" name="description" content="The Harvester node driver is used to provision VMs in the Harvester cluster. In this section, you&#x27;ll learn how to configure Rancher to use the Harvester node driver to launch and manage Kubernetes clusters."><meta data-rh="true" property="og:description" content="The Harvester node driver is used to provision VMs in the Harvester cluster. In this section, you&#x27;ll learn how to configure Rancher to use the Harvester node driver to launch and manage Kubernetes clusters."><meta data-rh="true" name="keywords" content="Harvester,harvester,Rancher,rancher,Harvester Node Driver"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.harvesterhci.io/dev/rancher/node/node-driver"><link data-rh="true" rel="alternate" href="https://docs.harvesterhci.io/dev/rancher/node/node-driver" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.harvesterhci.io/zh/dev/rancher/node/node-driver" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.harvesterhci.io/dev/rancher/node/node-driver" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://U7QCSJFCWR-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>


<link rel="search" type="application/opensearchdescription+xml" title="Harvester" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.831dbdae.css">
<link rel="preload" href="/assets/js/runtime~main.693e3b15.js" as="script">
<link rel="preload" href="/assets/js/main.d1ef793e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_horizontal.svg" alt="Harvester Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_horizontal.svg" alt="Harvester Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/dev/">v1.2-dev</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/dev/rancher/node/node-driver">v1.2-dev</a></li><li><a class="dropdown__link" href="/v1.1/rancher/node/node-driver">v1.1</a></li><li><a class="dropdown__link" href="/v1.0/rancher/node/node-driver">v1.0</a></li><li><a class="dropdown__link" href="/v0.3/rancher/node/node-driver">v0.3</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/dev/rancher/node/node-driver" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh/dev/rancher/node/node-driver" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__docs navbar__link--active" href="/dev/">Docs</a><a href="https://www.suse.com/c/?s=harvester" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__blog">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://harvesterhci.io/kb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__kb">Knowledge Base<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/harvester/harvester" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev/">Harvester Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev/install/requirements">Installation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev/airgap">Air Gapped Environment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev/upgrade/automatic">Upgrade</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev/authentication">Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev/upload-image">Upload Images</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev/host/">Host Management</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev/vm/create-vm">VM Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev/volume/create-volume">Volume Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev/networking/clusternetwork">Networking</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev/logging/">Logging Audit Event</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev/monitoring/">Monitoring</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev/advanced/settings">Advanced</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/dev/rancher/rancher-integration">Rancher Integration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev/rancher/rancher-integration">Rancher Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev/rancher/virtualization-management">Virtualization Management</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/dev/rancher/node/node-driver">Harvester Node Driver</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dev/rancher/node/node-driver">Harvester Node Driver</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/dev/rancher/node/rke1-cluster">Creating an RKE1 Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/dev/rancher/node/rke2-cluster">Creating an RKE2 Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/dev/rancher/node/k3s-cluster">Creating an K3s Kubernetes Cluster</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev/rancher/cloud-provider">Harvester Cloud Provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev/rancher/csi-driver">Harvester CSI Driver</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev/terraform/">Harvester Terraform Provider</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/dev/troubleshooting/installation">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev/faq">FAQ</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <b>Harvester</b> <b>v1.2-dev</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/v1.1/rancher/node/node-driver">latest version</a></b> (<!-- -->v1.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Rancher Integration</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Harvester Node Driver</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Harvester Node Driver</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.2-dev</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Harvester Node Driver</h1></header><p>The Harvester node driver is used to provision VMs in the Harvester cluster. In this section, you&#x27;ll learn how to configure Rancher to use the Harvester node driver to launch and manage Kubernetes clusters.</p><p>A node driver is the same as a <a href="https://docs.docker.com/machine/" target="_blank" rel="noopener noreferrer">Docker Machine driver</a>, and the project repo is available at <a href="https://github.com/harvester/docker-machine-driver-harvester" target="_blank" rel="noopener noreferrer">harvester/docker-machine-driver-harvester</a>.</p><p>You can now provision RKE1/RKE2 Kubernetes clusters in Rancher <code>v2.6.3+</code> with the built-in Harvester node driver.
Additionally, Harvester now can provide built-in <a href="/dev/rancher/cloud-provider">Load Balancer support</a> as well as Harvester cluster <a href="/dev/rancher/csi-driver">storage passthrough</a> support to the guest Kubernetes cluster.</p><p>While you can <a href="/dev/upload-image#upload-images-via-local-file">upload and view <code>.ISO</code> images in the Harvester UI</a>, the same capability is not available in the Rancher UI. For more information on this, see the <a href="https://rancher.com/docs/rancher/v2.6/en/virtualization-admin/#harvester-node-driver" target="_blank" rel="noopener noreferrer">Rancher docs</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="harvester-node-driver">Harvester Node Driver<a href="#harvester-node-driver" class="hash-link" aria-label="Direct link to Harvester Node Driver" title="Direct link to Harvester Node Driver">​</a></h2><p>The Harvester node driver is enabled by default from Rancher <code>v2.6.3</code>. You can go to <code>Cluster Management</code> &gt; <code>Drivers</code> &gt; <code>Node Drivers</code> page to manage the Harvester node driver manually.</p><p>When the Harvester node driver is enabled, you can create Kubernetes clusters on top of the Harvester cluster and manage them from Rancher.</p><p><img loading="lazy" alt="rke1-cluster" src="/assets/images/rke1-node-driver-f8868c55d2aa08ff3d613ef8c6ce673b.png" width="5118" height="1972" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="support-matrix">Support Matrix<a href="#support-matrix" class="hash-link" aria-label="Direct link to Support Matrix" title="Direct link to Support Matrix">​</a></h3><p>Refer to <a href="https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/rancher-v2-6-9" target="_blank" rel="noopener noreferrer">Rancher Downstream Cluster Support Matrix</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="known-issues">Known Issues<a href="#known-issues" class="hash-link" aria-label="Direct link to Known Issues" title="Direct link to Known Issues">​</a></h2><table><thead><tr><th>Summary</th><th>Status</th><th>Last Updated</th></tr></thead><tbody><tr><td><a href="https://github.com/harvester/harvester/issues/3272" target="_blank" rel="noopener noreferrer">Volumes created by the Harvester CSI driver in the host Harvester cluster would be deleted after editing/deleting the guest cluster</a></td><td>Resolved</td><td>2023-05-08</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="volumes-created-by-the-harvester-csi-driver-in-the-host-harvester-cluster-would-be-deleted-after-editingdeleting-the-guest-cluster">Volumes created by the Harvester CSI driver in the host Harvester cluster would be deleted after editing/deleting the guest cluster<a href="#volumes-created-by-the-harvester-csi-driver-in-the-host-harvester-cluster-would-be-deleted-after-editingdeleting-the-guest-cluster" class="hash-link" aria-label="Direct link to Volumes created by the Harvester CSI driver in the host Harvester cluster would be deleted after editing/deleting the guest cluster" title="Direct link to Volumes created by the Harvester CSI driver in the host Harvester cluster would be deleted after editing/deleting the guest cluster">​</a></h3><table><thead><tr><th>Status</th><th>Last updated</th></tr></thead><tbody><tr><td>Resolved(Rancher &gt;= v2.7.2)</td><td>2023-05-08</td></tr></tbody></table><p><strong>Workaround</strong>: You can temporarily change the Harvester node driver version to <a href="https://github.com/harvester/docker-machine-driver-harvester/releases/tag/v0.6.3" target="_blank" rel="noopener noreferrer">v0.6.3</a> from the Rancher UI.</p><ol><li>Go to the Rancher UI and click <code>Cluster Management</code> &gt; <code>Drivers</code> &gt; <code>Node Drivers</code>. In the <code>Node Drivers</code> list, find <code> Harvester</code> and then click <code>⋮</code>  &gt; <code>View in API</code>.</li><li>Click <code>Edit</code>.</li><li>Uncheck the <code>builtin</code> checkbox.</li><li>Change the <code>*url</code> to <code>https://releases.rancher.com/harvester-node-driver/v0.6.3/docker-machine-driver-harvester-amd64.tar.gz</code>.</li><li>Change the <code>checksum</code> to <code>159516f8f438e9b1726418ec8608625384aba1857bc89dff4a6ff16b31357c28</code>.</li><li>Click <code>Show Request</code> &gt; <code>Send Request</code>.</li><li>Click <code>Reload</code> until the value of <code>status.appliedChecksum</code> and <code>status.appliedURL</code> change to the value we set.</li></ol><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Changes to the node driver cannot be persisted. In other words, the changes will be lost after you restart the Rancher container.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>To use this workaround, you need to ensure that the connection to the url is stable.
If your environment is an air-gapped environment, you need to download the file and host it on the Intranet.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Starting with v0.6.3, the Harvester node driver has removed the <code>qemu-guest-agent</code> auto-injection from the backend. If the image you are using does not contain the <code>qemu-guest-agent</code> package, you can use <code>userdata</code> config to install and boot <code>qemu-guest-agent</code>. Otherwise, the cluster will not be provisioned successfully.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#cloud-config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">package_update</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> qemu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">guest</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">runcmd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> systemctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--now&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> qemu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">guest</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p><strong>Resolution</strong>: Rancher v2.7.2 has been released with the fixed node driver version v0.6.3 for this issue. And Rancher v2.7.2 UI will do the <code>qemu-guest-agent</code> auto-injection.</p><p><strong>Affected versions</strong>:</p><ul><li>Rancher: v2.6.x,v2.7.0,v2.7.1</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rke1-kubernetes-cluster">RKE1 Kubernetes Cluster<a href="#rke1-kubernetes-cluster" class="hash-link" aria-label="Direct link to RKE1 Kubernetes Cluster" title="Direct link to RKE1 Kubernetes Cluster">​</a></h2><p>Click to learn <a href="/dev/rancher/node/rke1-cluster">how to create RKE1 Kubernetes Clusters</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rke2-kubernetes-cluster">RKE2 Kubernetes Cluster<a href="#rke2-kubernetes-cluster" class="hash-link" aria-label="Direct link to RKE2 Kubernetes Cluster" title="Direct link to RKE2 Kubernetes Cluster">​</a></h2><p>Click to learn <a href="/dev/rancher/node/rke2-cluster">how to create RKE2 Kubernetes Clusters</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="k3s-kubernetes-cluster">K3s Kubernetes Cluster<a href="#k3s-kubernetes-cluster" class="hash-link" aria-label="Direct link to K3s Kubernetes Cluster" title="Direct link to K3s Kubernetes Cluster">​</a></h2><p>Click to learn <a href="/dev/rancher/node/k3s-cluster">how to create k3s Kubernetes Clusters</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="topology-spread-constraints">Topology Spread Constraints<a href="#topology-spread-constraints" class="hash-link" aria-label="Direct link to Topology Spread Constraints" title="Direct link to Topology Spread Constraints">​</a></h2><p><em>Available as of v1.0.3</em></p><p>In your guest Kubernetes cluster, you can use <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/" target="_blank" rel="noopener noreferrer">topology spread constraints</a> to control how workloads are spread across the Harvester VMs among failure-domains such as regions and zones. This can help to achieve high availability as well as efficient resource utilization of your cluster resources.</p><p>The minimum RKE2 versions required to support the sync topology label feature are as follows:</p><table><thead><tr><th align="left">Supported RKE2 Version</th></tr></thead><tbody><tr><td align="left">&gt;<!-- -->=  v1.24.3+rke2r1</td></tr><tr><td align="left">&gt;<!-- -->=  v1.23.9+rke2r1</td></tr><tr><td align="left">&gt;<!-- -->=  v1.22.12+rke2r1</td></tr></tbody></table><p>In addition, the cloud provider version installed via the <code>Apps</code> of RKE/K3s must be &gt;= v0.1.4</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sync-topology-labels-to-the-guest-cluster-node">Sync Topology Labels to the Guest Cluster Node<a href="#sync-topology-labels-to-the-guest-cluster-node" class="hash-link" aria-label="Direct link to Sync Topology Labels to the Guest Cluster Node" title="Direct link to Sync Topology Labels to the Guest Cluster Node">​</a></h3><p>During the cluster installation, the Harvester node driver will automatically help synchronize topology labels from VM nodes to guest cluster nodes. Currently, only <code>region</code> and <code>zone</code> topology labels are supported.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>For Harvester CCM versions prior to v0.2.0, label synchronization will only occur during the initialization of guest nodes. To prevent nodes from drifting to different regions or zones, we recommend adding <a href="/dev/rancher/node/rke2-cluster#add-node-affinity">node affinity rules</a> during cluster provisioning. This will allow you to schedule VMs in the same zone even after rebuilding.</p><p>With the introduction of Harvester cloud provider v0.2.0, topology labels on the Harvester node will automatically resynchronize when a VM corresponding to the guest node undergoes migration or changes.</p></div></div><ol><li><p>Configuring topology labels on the Harvester nodes through <code>Hosts &gt; Edit Config &gt; Labels</code>. e.g., add the topology labels as follows:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">topology.kubernetes.io/region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">east</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">topology.kubernetes.io/zone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">east</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/node-add-affinity-labels-427cc8103802bf12cb3c6c8ac89086f3.png" width="4374" height="1820" class="img_ev3q"></p></li><li><p>Creating a guest Kubernetes cluster using the Harvester node driver and it is recommended to add the <a href="/dev/rancher/node/rke2-cluster#add-node-affinity">node affinity rules</a>, this will help to avoid node drifting to other zones after VM rebuilding.</p></li><li><p>After the cluster is successfully deployed, confirm that guest Kubernetes node labels are successfully synchronized from the Harvester VM node.</p></li><li><p>Now deploy workloads on your guest Kubernetes cluster, and you should be able to manage them using the <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/" target="_blank" rel="noopener noreferrer">topology spread constraints</a>.</p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/harvester/docs/edit/main/docs/rancher/node/node-driver.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-07-02T15:44:54.000Z">Jul 2, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/dev/rancher/virtualization-management"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Virtualization Management</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/dev/rancher/node/rke1-cluster"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Creating an RKE1 Kubernetes Cluster</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#harvester-node-driver" class="table-of-contents__link toc-highlight">Harvester Node Driver</a><ul><li><a href="#support-matrix" class="table-of-contents__link toc-highlight">Support Matrix</a></li></ul></li><li><a href="#known-issues" class="table-of-contents__link toc-highlight">Known Issues</a><ul><li><a href="#volumes-created-by-the-harvester-csi-driver-in-the-host-harvester-cluster-would-be-deleted-after-editingdeleting-the-guest-cluster" class="table-of-contents__link toc-highlight">Volumes created by the Harvester CSI driver in the host Harvester cluster would be deleted after editing/deleting the guest cluster</a></li></ul></li><li><a href="#rke1-kubernetes-cluster" class="table-of-contents__link toc-highlight">RKE1 Kubernetes Cluster</a></li><li><a href="#rke2-kubernetes-cluster" class="table-of-contents__link toc-highlight">RKE2 Kubernetes Cluster</a></li><li><a href="#k3s-kubernetes-cluster" class="table-of-contents__link toc-highlight">K3s Kubernetes Cluster</a></li><li><a href="#topology-spread-constraints" class="table-of-contents__link toc-highlight">Topology Spread Constraints</a><ul><li><a href="#sync-topology-labels-to-the-guest-cluster-node" class="table-of-contents__link toc-highlight">Sync Topology Labels to the Guest Cluster Node</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 harvesterhci.io</div></div></div></footer></div>
<script src="/assets/js/runtime~main.693e3b15.js"></script>
<script src="/assets/js/main.d1ef793e.js"></script>
</body>
</html>